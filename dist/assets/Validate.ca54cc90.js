import{m as e,e as l,f as a,o as u,g as t,w as n,n as s,h as o,v,k as i,F as d,t as r,i as c,q as f,r as p,b as m}from"./vendor.af05a33c.js";import{c as g,v as y}from"./index.353ec8bd.js";import{_ as b}from"./index.3dc09f85.js";const h={key:0},k=c("認證碼："),V={key:1},q=c("收到認證碼的信箱："),w=["disabled"];var I=b(f({name:"Validate",components:{ValidateForm:{setup(c){const f=e();console.log(f.query);const p=l(""),m=l(""),b=l(""),I=l(""),j=l(!1),x=l(!1),C=l(!1),D=()=>{liff.closeWindow()},F=g().email().required(),U=async()=>{if(I.value="",C.value=!0,0===p.value.length)return C.value=!1,void alert("請輸入認證碼");let e=null;if(0===m.value.length){await F.isValid(b.value)?e=await y(p.value,null,b.value):alert("請輸入有效的信箱地址")}else e=await y(p.value,m.value,null);I.value=e&&e.data.message||"",C.value=!1};return a((()=>{p.value=f.query.code||"",j.value=p.value.length<=0,liff.init({liffId:"1656419833-74JqODyP"}).then((()=>{if(liff.isLoggedIn()&&liff.isInClient()){const e=liff.getDecodedIDToken();m.value=e&&e.sub,!j.value&&m.value.length>0?U():x.value=m.value.length<=0}else x.value=!0})).catch((e=>{console.log(e),j.value=!0,x.value=!0}))})),(e,l)=>(u(),t(d,null,[j.value?n((u(),t("p",h,[k,n(o("input",{type:"email","onUpdate:modelValue":l[0]||(l[0]=e=>p.value=e),placeholder:"請輸入認證碼"},null,512),[[v,p.value]])],512)),[[s,!C.value]]):i("",!0),x.value?n((u(),t("p",V,[q,n(o("input",{type:"email","onUpdate:modelValue":l[1]||(l[1]=e=>b.value=e),placeholder:"請輸入收到認證碼的信箱"},null,512),[[v,b.value]])],512)),[[s,!C.value]]):i("",!0),j.value||x.value?n((u(),t("button",{key:2,type:"button",class:"btn",onClick:l[2]||(l[2]=e=>U()),disabled:C.value},"送出",8,w)),[[s,!C.value]]):i("",!0),n(o("p",null,"認證中，請稍候...",512),[[s,C.value]]),I.value.length>0?(u(),t(d,{key:3},[o("p",null,r("success"===I.value?"認證成功":"認證失敗"),1),o("button",{type:"button",class:"btn",onClick:D},"關閉")],64)):i("",!0)],64))}}}}),[["render",function(e,l,a,t,n,s){const o=p("ValidateForm");return u(),m(o)}]]);export{I as default};
