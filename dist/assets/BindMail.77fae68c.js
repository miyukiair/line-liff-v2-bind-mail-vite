import{e,f as a,o as l,g as t,h as s,t as n,F as u,w as i,v as o,i as v,j as c,u as r,k as d,p,b as f,l as b}from"./vendor.af05a33c.js";import{c as m,s as k}from"./index.353ec8bd.js";const y=["disabled"],g=v("發送身份認證碼到 "),h=["disabled"],S={emits:["backStep","nextStep"],setup(v,{emit:c}){const r=e(""),d=e(""),p=e(""),f=e(""),b=e(!1),S=m().email().required(),w=async e=>{b.value=!0;await S.isValid(e)?k(r.value,e,d.value).then((e=>{console.log("res: ",e);const a=e.data.message;c("nextStep",a)})).catch((e=>{console.log("err: ",e)})).finally((()=>{b.value=!1})):(b.value=!1,alert("請輸入有效的信箱地址"))};return a((()=>{liff.ready.then((()=>{const e=liff.getDecodedIDToken();r.value=e&&e.name,d.value=e&&e.sub,p.value=e&&e.email}))})),(e,a)=>p.value?(l(),t(u,{key:0},[s("p",null,"將發送身份認證碼到 "+n(p.value),1),s("button",{type:"button",class:"btn",onClick:a[0]||(a[0]=e=>w(p.value)),disabled:b.value},"確定",8,y)],64)):(l(),t(u,{key:1},[s("p",null,[g,i(s("input",{type:"email","onUpdate:modelValue":a[1]||(a[1]=e=>f.value=e),placeholder:"請輸入 Email"},null,512),[[o,f.value]])]),s("button",{type:"button",class:"btn",onClick:a[2]||(a[2]=e=>w(f.value)),disabled:b.value},"確定",8,h)],64))}},w={class:"inline-btns"},x=["disabled"],C=v(" 再次發送 "),F={key:0},I={emits:["backStep","nextStep"],setup(i,{emit:o}){const v=e(null),p=e(0),f=e(!0),b=c("resMessage"),m=()=>{liff.closeWindow()},k=e=>{v.value||(v.value=e),p.value=e-v.value,p.value<6e4?window.requestAnimationFrame(k):f.value=!1};return a((()=>{v.value=null,window.requestAnimationFrame(k)})),(e,a)=>(l(),t(u,null,[s("p",null,n("success"===r(b)?"已將驗證碼發送至信箱":"發送失敗，請稍後再試"),1),s("div",w,[s("button",{type:"button",class:"btn",onClick:a[0]||(a[0]=e=>o("backStep")),disabled:f.value},[C,p.value<6e4?(l(),t("span",F,"("+n(60-Math.floor(p.value/1e3))+")",1)):d("",!0)],8,x),s("button",{type:"button",class:"btn",onClick:m},"關閉")])],64))}},q=s("h1",null,"驗證碼小幫手 - 身份認證",-1),j={key:1,class:"error"},D={setup(s){const i=e(""),o=e("form"),v=e("");p("resMessage",v);const c=e=>{v.value=e,o.value="result"},r=()=>{v.value="",o.value="form"};return a((()=>{liff.init({liffId:"1656419833-74JqODyP"}).then((()=>{liff.isLoggedIn()&&liff.isInClient()||(i.value="please use line liff open")})).catch((e=>{i.value="initialize LIFF fail"}))})),(e,a)=>(l(),t(u,null,[q,i.value?(l(),t("p",j,n(i.value),1)):(l(),f(b("form"===o.value?S:I),{key:0,onBackStep:r,onNextStep:c}))],64))}};export{D as default};
