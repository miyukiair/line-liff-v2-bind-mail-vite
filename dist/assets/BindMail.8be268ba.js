import{g as e,h as l,i as a,j as t,o as s,b as n,e as u,t as o,F as i,w as c,v as r,k as v,l as p,u as d,m as f,p as b,n as m,q as y}from"./vendor.dbfd27f8.js";const k=["disabled"],g=v("發送身份認證碼到 "),h=["disabled"],w={emits:["backStep","nextStep"],setup(v,{emit:p}){const d=l(""),f=l(""),b=l(""),m=l(""),y=l(!1),w=a().email().required(),x=async l=>{y.value=!0;await w.isValid(l)?((l,a,t)=>{let s=JSON.stringify({name:l,mail:a,token:t});return e.post("https://script.google.com/macros/s/AKfycbxpx6GgQiGJYGeR0t8jO2NvTqnM02k8sinIHXGWlnqsx3tyYVWNlDBSUqiBdlKG_bAsYg/exec",s,{headers:{"content-type":"application/x-www-form-urlencoded"}}).then((e=>e||Promise.reject())).catch((e=>{console.log("error",e)}))})(d.value,l,f.value).then((e=>{console.log("res: ",e);const l=e.data.message;p("nextStep",l)})).catch((e=>{console.log("err: ",e)})).finally((()=>{y.value=!1})):(y.value=!1,alert("請輸入有效的信箱地址"))};return t((()=>{liff.ready.then((()=>{const e=liff.getDecodedIDToken();d.value=e&&e.name,f.value=e&&e.sub,b.value=e&&e.email}))})),(e,l)=>b.value?(s(),n(i,{key:0},[u("p",null,"將發送身份認證碼到 "+o(b.value),1),u("button",{type:"button",class:"btn",onClick:l[0]||(l[0]=e=>x(b.value)),disabled:y.value},"確定",8,k)],64)):(s(),n(i,{key:1},[u("p",null,[g,c(u("input",{type:"email","onUpdate:modelValue":l[1]||(l[1]=e=>m.value=e),placeholder:"請輸入 Email"},null,512),[[r,m.value]])]),u("button",{type:"button",class:"btn",onClick:l[2]||(l[2]=e=>x(m.value)),disabled:y.value},"確定",8,h)],64))}},x={class:"inline-btns"},S=["disabled"],q=v(" 再次發送 "),I={key:0},C={emits:["backStep","nextStep"],setup(e,{emit:a}){const c=l(null),r=l(0),v=l(!0),b=p("resMessage"),m=()=>{liff.closeWindow()},y=e=>{c.value||(c.value=e),r.value=e-c.value,r.value<6e4?window.requestAnimationFrame(y):v.value=!1};return t((()=>{c.value=null,window.requestAnimationFrame(y)})),(e,l)=>(s(),n(i,null,[u("p",null,o("success"===d(b)?"已將驗證碼發送至信箱":"發送失敗，請稍後再試"),1),u("div",x,[u("button",{type:"button",class:"btn",onClick:l[0]||(l[0]=e=>a("backStep")),disabled:v.value},[q,r.value<6e4?(s(),n("span",I,"("+o(60-Math.floor(r.value/1e3))+")",1)):f("",!0)],8,S),u("button",{type:"button",class:"btn",onClick:m},"關閉")])],64))}},F=u("h1",null,"驗證碼小幫手 - 身份認證",-1),G={key:1,class:"error"},j={setup(e){const a=l(""),u=l("form"),c=l("");b("resMessage",c);const r=e=>{c.value=e,u.value="result"},v=()=>{c.value="",u.value="form"};return t((()=>{liff.init({liffId:"1656419833-74JqODyP"}).then((()=>{liff.isLoggedIn()&&liff.isInClient()||(a.value="please use line liff open")})).catch((e=>{a.value="initialize LIFF fail"}))})),(e,l)=>(s(),n(i,null,[F,a.value?(s(),n("p",G,o(a.value),1)):(s(),m(y("form"===u.value?w:C),{key:0,onBackStep:v,onNextStep:r}))],64))}};export{j as default};
