import{a as e,r as l,c as t,o as a,b as n,d as s,e as o,t as i,F as r,w as u,v as c,f as d,i as p,u as f,g as v,p as m,h as b,j as y,k as g}from"./vendor.884ac2ff.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&l(e)})).observe(document,{childList:!0,subtree:!0})}function l(e){if(e.ep)return;e.ep=!0;const l=function(e){const l={};return e.integrity&&(l.integrity=e.integrity),e.referrerpolicy&&(l.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?l.credentials="include":"anonymous"===e.crossorigin?l.credentials="omit":l.credentials="same-origin",l}(e);fetch(e.href,l)}}();const k=["disabled"],h=d("發送身份認證碼到 "),w=["disabled"],S={emits:["backStep","nextStep"],setup(d,{emit:p}){const f=l(""),v=l(""),m=l(""),b=l(""),y=l(!1),g=t().email().required(),S=async l=>{y.value=!0;await g.isValid(l)?((l,t,a)=>{let n=JSON.stringify({name:l,mail:t,token:a});return e.post("https://script.google.com/macros/s/AKfycbxpx6GgQiGJYGeR0t8jO2NvTqnM02k8sinIHXGWlnqsx3tyYVWNlDBSUqiBdlKG_bAsYg/exec",n,{headers:{"content-type":"application/x-www-form-urlencoded"}}).then((e=>e||Promise.reject())).catch((e=>{console.log("error",e)}))})(f.value,l,v.value).then((e=>{console.log("res: ",e);const l=e.data.message;p("nextStep",l)})).catch((e=>{console.log("err: ",e)})).finally((()=>{y.value=!1})):(y.value=!1,alert("請輸入有效的信箱地址"))};return a((()=>{liff.ready.then((()=>{const e=liff.getDecodedIDToken();f.value=e&&e.name,v.value=e&&e.sub,m.value=e&&e.email}))})),(e,l)=>m.value?(n(),s(r,{key:0},[o("p",null,"將發送身份認證碼到 "+i(m.value),1),o("button",{type:"button",class:"btn",onClick:l[0]||(l[0]=e=>S(m.value)),disabled:y.value},"確定",8,k)],64)):(n(),s(r,{key:1},[o("p",null,[h,u(o("input",{type:"email","onUpdate:modelValue":l[1]||(l[1]=e=>b.value=e),placeholder:"請輸入 Email"},null,512),[[c,b.value]])]),o("button",{type:"button",class:"btn",onClick:l[2]||(l[2]=e=>S(b.value)),disabled:y.value},"確定",8,w)],64))}},x={class:"inline-btns"},q=["disabled"],I=d(" 再次發送 "),N={key:0},L={emits:["backStep","nextStep"],setup(e,{emit:t}){const u=l(null),c=l(0),d=l(!0),m=p("resMessage"),b=()=>{liff.closeWindow()},y=e=>{u.value||(u.value=e),c.value=e-u.value,c.value<6e4?window.requestAnimationFrame(y):d.value=!1};return a((()=>{u.value=null,window.requestAnimationFrame(y)})),(e,l)=>(n(),s(r,null,[o("p",null,i("success"===f(m)?"已將驗證碼發送至信箱":"發送失敗，請稍後再試"),1),o("div",x,[o("button",{type:"button",class:"btn",onClick:l[0]||(l[0]=e=>t("backStep")),disabled:d.value},[I,c.value<6e4?(n(),s("span",N,"("+i(60-Math.floor(c.value/1e3))+")",1)):v("",!0)],8,q),o("button",{type:"button",class:"btn",onClick:b},"關閉")])],64))}},A=o("h1",null,"驗證碼小幫手 - 身份認證",-1),C={key:1,class:"error"},F={setup(e){const t=l(""),o=l("form"),u=l("");m("resMessage",u);const c=e=>{u.value=e,o.value="result"},d=()=>{u.value="",o.value="form"};return a((()=>{liff.init({liffId:"1656419833-74JqODyP"}).then((()=>{liff.isLoggedIn()&&liff.isInClient()||(t.value="please use line liff open")})).catch((e=>{t.value="initialize LIFF fail"}))})),(e,l)=>(n(),s(r,null,[A,t.value?(n(),s("p",C,i(t.value),1)):(n(),b(y("form"===o.value?S:L),{key:0,onBackStep:d,onNextStep:c}))],64))}};g({setup:e=>(e,l)=>(n(),b(F))}).mount("#app");
